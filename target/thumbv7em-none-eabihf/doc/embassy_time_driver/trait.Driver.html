<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Time driver"><title>Driver in embassy_time_driver - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="embassy_time_driver" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.1 (4eb161250 2025-03-15)" data-channel="1.85.1" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../embassy_time_driver/index.html">embassy_<wbr>time_<wbr>driver</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Driver</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.allocate_alarm" title="allocate_alarm">allocate_alarm</a></li><li><a href="#tymethod.now" title="now">now</a></li><li><a href="#tymethod.set_alarm" title="set_alarm">set_alarm</a></li><li><a href="#tymethod.set_alarm_callback" title="set_alarm_callback">set_alarm_callback</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="index.html">In crate embassy_<wbr>time_<wbr>driver</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="index.html">embassy_time_driver</a></span><h1>Trait <span class="trait">Driver</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/embassy_time_driver/lib.rs.html#96-135">Source</a> </span></div><pre class="rust item-decl"><code>pub trait Driver:
    <a class="trait" href="https://doc.rust-lang.org/1.85.1/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a>
    + <a class="trait" href="https://doc.rust-lang.org/1.85.1/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a>
    + 'static {
    // Required methods
    fn <a href="#tymethod.now" class="fn">now</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.u64.html">u64</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.allocate_alarm" class="fn">allocate_alarm</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.85.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.set_alarm_callback" class="fn">set_alarm_callback</a>(
        &amp;self,
        alarm: <a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>,
        callback: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.fn.html">fn</a>(_: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.pointer.html">*mut </a><a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.unit.html">()</a>),
        ctx: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.pointer.html">*mut </a><a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.unit.html">()</a>,
    );
<span class="item-spacer"></span>    fn <a href="#tymethod.set_alarm" class="fn">set_alarm</a>(&amp;self, alarm: <a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>, timestamp: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.u64.html">u64</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.bool.html">bool</a>;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Time driver</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.now" class="method"><a class="src rightside" href="../src/embassy_time_driver/lib.rs.html#107">Source</a><h4 class="code-header">fn <a href="#tymethod.now" class="fn">now</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Return the current timestamp in ticks.</p>
<p>Implementations MUST ensure that:</p>
<ul>
<li>This is guaranteed to be monotonic, i.e. a call to now() will always return
a greater or equal value than earler calls. Time can’t “roll backwards”.</li>
<li>It “never” overflows. It must not overflow in a sufficiently long time frame, say
in 10_000 years (Human civilization is likely to already have self-destructed
10_000 years from now.). This means if your hardware only has 16bit/32bit timers
you MUST extend them to 64-bit, for example by counting overflows in software,
or chaining multiple timers together.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.allocate_alarm" class="method"><a class="src rightside" href="../src/embassy_time_driver/lib.rs.html#114">Source</a><h4 class="code-header">unsafe fn <a href="#tymethod.allocate_alarm" class="fn">allocate_alarm</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.85.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>&gt;</h4></section></summary><div class="docblock"><p>Try allocating an alarm handle. Returns None if no alarms left.
Initially the alarm has no callback set, and a null <code>ctx</code> pointer.</p>
<h5 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h5>
<p>It is UB to make the alarm fire before setting a callback.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_alarm_callback" class="method"><a class="src rightside" href="../src/embassy_time_driver/lib.rs.html#118">Source</a><h4 class="code-header">fn <a href="#tymethod.set_alarm_callback" class="fn">set_alarm_callback</a>(
    &amp;self,
    alarm: <a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>,
    callback: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.fn.html">fn</a>(_: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.pointer.html">*mut </a><a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.unit.html">()</a>),
    ctx: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.pointer.html">*mut </a><a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.unit.html">()</a>,
)</h4></section></summary><div class="docblock"><p>Sets the callback function to be called when the alarm triggers.
The callback may be called from any context (interrupt or thread mode).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_alarm" class="method"><a class="src rightside" href="../src/embassy_time_driver/lib.rs.html#134">Source</a><h4 class="code-header">fn <a href="#tymethod.set_alarm" class="fn">set_alarm</a>(&amp;self, alarm: <a class="struct" href="struct.AlarmHandle.html" title="struct embassy_time_driver::AlarmHandle">AlarmHandle</a>, timestamp: <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.u64.html">u64</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.85.1/core/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Sets an alarm at the given timestamp. When the current timestamp reaches the alarm
timestamp, the provided callback function will be called.</p>
<p>The <code>Driver</code> implementation should guarantee that the alarm callback is never called synchronously from <code>set_alarm</code>.
Rather - if <code>timestamp</code> is already in the past - <code>false</code> should be returned and alarm should not be set,
or alternatively, the driver should return <code>true</code> and arrange to call the alarm callback as soon as possible, but not synchronously.
There is a rare third possibility that the alarm was barely in the future, and by the time it was enabled, it had slipped into the
past.  This is can be detected by double-checking that the alarm is still in the future after enabling it; if it isn’t, <code>false</code>
should also be returned to indicate that the callback may have been called already by the alarm, but it is not guaranteed, so the
caller should also call the callback, just like in the more common <code>false</code> case. (Note: This requires idempotency of the callback.)</p>
<p>When callback is called, it is guaranteed that now() will return a value greater or equal than timestamp.</p>
<p>Only one alarm can be active at a time for each AlarmHandle. This overwrites any previously-set alarm if any.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../trait.impl/embassy_time_driver/trait.Driver.js" async></script></section></div></main></body></html>